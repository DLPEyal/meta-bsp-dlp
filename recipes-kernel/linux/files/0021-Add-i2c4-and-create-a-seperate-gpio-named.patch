From 3a7f848ec0ef4f45c5dc88a197a1c82b4bdc07bd Mon Sep 17 00:00:00 2001
From: Orel Eliyahu <orel_e@eyal-emi.co.il>
Date: Mon, 15 Sep 2025 13:58:24 +0300
Subject: [PATCH] Add i2c4 and create a seperate gpio named

---
 arch/arm64/boot/dts/freescale/base.dts        | 34 +++++++++++++++----
 .../boot/dts/freescale/base_gpio_named.h      | 13 +++++++
 arch/arm64/boot/dts/freescale/decoder.dts     |  2 +-
 .../boot/dts/freescale/decoder_gpio_named.h   | 14 ++++++++
 4 files changed, 55 insertions(+), 8 deletions(-)
 mode change 100644 => 100755 arch/arm64/boot/dts/freescale/base.dts
 create mode 100755 arch/arm64/boot/dts/freescale/base_gpio_named.h
 mode change 100644 => 100755 arch/arm64/boot/dts/freescale/decoder.dts
 create mode 100755 arch/arm64/boot/dts/freescale/decoder_gpio_named.h

diff --git a/arch/arm64/boot/dts/freescale/base.dts b/arch/arm64/boot/dts/freescale/base.dts
old mode 100644
new mode 100755
index c503bbe0654e..9ed656d41684
--- a/arch/arm64/boot/dts/freescale/base.dts
+++ b/arch/arm64/boot/dts/freescale/base.dts
@@ -7,7 +7,7 @@
 
 #include <dt-bindings/usb/pd.h>
 #include "imx8mp.dtsi"
-#include "gpio_named.h"
+#include "base_gpio_named.h"
 #include "usb_whitelist.h"
 
 / {
@@ -323,7 +323,7 @@ spidev1: spi@0 {
 &eqos {
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_eqos>;
-	phy-mode = "rgmii-id";
+	phy-mode = "rgmii";
 	status = "okay";
 
          fixed-link {
@@ -348,7 +348,7 @@ ethphy1: ethernet-phy@0 {
 			compatible = "marvell,88e1510"; // 
 			reg = <0>;
 			marvell,reg-init = <3 0x10 0 0x880>; // Optional: configure LED or clk output if needed
-			reset-gpios = <&gpio1 5 GPIO_ACTIVE_LOW>;
+			reset-gpios = <&gpio1 5 GPIO_ACTIVE_LOW>, <&gpio1 6 GPIO_ACTIVE_LOW>;
 			reset-assert-us = <10000>;
 			reset-deassert-us = <80000>;
 			// If you know the PHY needs this (88E1512 usually doesn't need eee-broken-1000t)
@@ -362,9 +362,9 @@ &i2c1 {
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_i2c1>;
 	status = "okay";
-	 at24@50 { /* EEPROM at 0x50 (A0, A1, A2 = 0) */
+	 at24@50 { /* EEPROM at 0xa2 (A0, A1, A2 = 0) */
 		compatible = "atmel,24c02";
-		reg = <0x50>;
+		reg = <0xa2>;
 		pagesize = <8>;
 		size = <256>; /* 2Kb = 256 Bytes */
 	    };
@@ -565,6 +565,19 @@ codec: wm8960@1a {
 	
 };
 
+&i2c4 {
+	clock-frequency = <400000>;
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_i2c4>;
+	status = "okay";
+	 at24@51 { /* EEPROM at 0x51 (A0, A1, A2 = 0) */
+		compatible = "atmel,24c02";
+		reg = <0x51>;
+		pagesize = <8>;
+		size = <256>; /* 2Kb = 256 Bytes */
+	    };
+};
+
 &irqsteer_hdmi {
 	status = "okay";
 };
@@ -1023,12 +1036,20 @@ MX8MP_IOMUXC_I2C2_SDA__I2C2_SDA		0x400001c2
 		>;
 	};
 
+                  
 	pinctrl_i2c3: i2c3grp {
 		fsl,pins = <
 			MX8MP_IOMUXC_I2C3_SCL__I2C3_SCL		0x400001c2
 			MX8MP_IOMUXC_I2C3_SDA__I2C3_SDA		0x400001c2
 		>;
 	};
+	
+	pinctrl_i2c4: i2c4grp {
+		fsl,pins = <
+			MX8MP_IOMUXC_I2C4_SCL__I2C4_SCL            0x400001c2
+			MX8MP_IOMUXC_I2C4_SDA__I2C4_SDA            0x400001c2
+		>;
+	};
 
 	pinctrl_mipi_dsi_en: mipi_dsi_en {
 		fsl,pins = <
@@ -1038,8 +1059,7 @@ pinctrl_mipi_dsi_en: mipi_dsi_en {
 
 	pinctrl_pcie: pciegrp {
 		fsl,pins = <
-			MX8MP_IOMUXC_I2C4_SCL__PCIE_CLKREQ_B		0x60 /* open drain, pull up */
-			MX8MP_IOMUXC_I2C4_SDA__GPIO5_IO21		0x1c4
+			
 		>;
 	};
 
diff --git a/arch/arm64/boot/dts/freescale/base_gpio_named.h b/arch/arm64/boot/dts/freescale/base_gpio_named.h
new file mode 100755
index 000000000000..cdd39c10e1fd
--- /dev/null
+++ b/arch/arm64/boot/dts/freescale/base_gpio_named.h
@@ -0,0 +1,13 @@
+/ {
+    kratos_station-pm {
+        compatible = "kratos,kratos_station-pm";
+        platform-unique;
+        status = "okay";
+        pin_numbers = <3 9 10 8 1 14 35 36 34 46 39 40 45 32 33 47 0>;
+        pin_names = "ARM_BUTTOM","PROG_EN_IN","ARM2_PLAT_UP_DEC_IN","INT_REBOOT","SRAM_LOCK","OTP_LOCK","LED0","LED1","LED2","GPIO0","GPIO1","GPIO2","GPIO3","GPIO4","GPIO5","BASE_DETECT","ERASE_STS_OUT";
+        pin_states = < GPIOF_OUT_INIT_LOW GPIOF_OUT_INIT_LOW GPIOF_OUT_INIT_LOW GPIOF_OUT_INIT_LOW GPIOF_IN GPIOF_IN GPIOF_IN GPIOF_IN GPIOF_IN GPIOF_OUT_INIT_LOW GPIOF_OUT_INIT_LOW GPIOF_OUT_INIT_LOW GPIOF_OUT_INIT_LOW GPIOF_OUT_INIT_LOW GPIOF_OUT_INIT_LOW GPIOF_OUT_INIT_LOW GPIOF_IN>;
+        pin_init_val = < 1 1 1 1 0 0 0 0 0 1 1 1 1 1 1 1 0>;  
+        
+       
+    };
+};
diff --git a/arch/arm64/boot/dts/freescale/decoder.dts b/arch/arm64/boot/dts/freescale/decoder.dts
old mode 100644
new mode 100755
index ceae30d2eec9..d72b0a54fa4e
--- a/arch/arm64/boot/dts/freescale/decoder.dts
+++ b/arch/arm64/boot/dts/freescale/decoder.dts
@@ -7,7 +7,7 @@
 
 #include <dt-bindings/usb/pd.h>
 #include "imx8mp.dtsi"
-#include "gpio_named.h"
+#include "decoder_gpio_named.h"
 #include "usb_whitelist.h"
 
 / {
diff --git a/arch/arm64/boot/dts/freescale/decoder_gpio_named.h b/arch/arm64/boot/dts/freescale/decoder_gpio_named.h
new file mode 100755
index 000000000000..2be212035a44
--- /dev/null
+++ b/arch/arm64/boot/dts/freescale/decoder_gpio_named.h
@@ -0,0 +1,14 @@
+/ {
+    kratos_station-pm {
+        compatible = "kratos,kratos_station-pm";
+        platform-unique;
+        status = "okay";
+        pin_numbers = <13 12 11 15 4 37 10 9 8 1 14 35 36 34 46 39 40 45 32 33 47 0>;
+        pin_names = "PROG", "DONE", "INIT","FPGA_LOAD_LOCK","LAN7800_RESET","ARM BUTTOM","PROG_EN_IN","LOADER_DETECT","INT_REBOOT","SRAM_LOCK","OTP_LOCK","LED0","LED1","LED2","GPIO0","GPIO1","GPIO2","GPIO3","GPIO4","GPIO5","BASE_DETECT","ERASE_STS_OUT";
+        pin_states = < GPIOF_IN GPIOF_OUT_INIT_LOW GPIOF_OUT_INIT_LOW GPIOF_IN GPIOF_IN GPIOF_OUT_INIT_LOW GPIOF_OUT_INIT_LOW GPIOF_OUT_INIT_LOW GPIOF_IN GPIOF_IN GPIOF_IN GPIOF_IN GPIOF_IN GPIOF_IN GPIOF_OUT_INIT_LOW GPIOF_OUT_INIT_LOW GPIOF_OUT_INIT_LOW GPIOF_OUT_INIT_LOW GPIOF_OUT_INIT_LOW GPIOF_OUT_INIT_LOW GPIOF_OUT_INIT_LOW GPIOF_IN>;
+        pin_init_val = < 0 1 1 0 1 1 1 1 0 0 0 0 0 0 1 1 1 1 1 1 1 0>;  
+        
+        interrupt-gpios = <&gpio2 17 IRQ_TYPE_EDGE_RISING>;
+       
+    };
+};
